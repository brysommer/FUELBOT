// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Driver {
  id         Int          @id @default(autoincrement())
  firstName  String?
  phone      String       @unique
  carNumber  String       @unique
  tankVolume Int?
  chatId     BigInt       @unique
  step       Int
  createdAt  DateTime     @default(now())

  // Зворотній зв'язок — всі заправки цього водія
  fuelRecords FuelRecord[]
  fuelNorm    FuelNorm?     // один водій має одну норму
  shifts      Shift[]
}

model FuelNorm {
  id        Int     @id @default(autoincrement())
  driverId  Int     @unique
  driver    Driver  @relation(fields: [driverId], references: [id])
  norm      Float   // л/100км
  createdAt DateTime @default(now())
}

model Shift {
  id             Int       @id @default(autoincrement())
  driverId       Int
  driver         Driver    @relation(fields: [driverId], references: [id])

  odometerStart  BigInt
  odometerEnd    BigInt?
  distance       Float?    // (odometerEnd - odometerStart)
  fuelConsumed   Float?    // distance * norm / 100
  report         String?   // текстовий звіт
  startedAt      DateTime  @default(now())
  endedAt        DateTime?
  durationHours  Float?    // (endedAt - startedAt) в годинах
}

model FuelRecord {
  id          Int      @id @default(autoincrement())
  driverId    Int
  driver      Driver   @relation(fields: [driverId], references: [id])
  volume      Float    // обсяг заправки в літрах
  price       Float    // ціна за літр
  odometr     BigInt?  // одометр
  total       Float    // загальна сума за заправку (volume * price)
  date        DateTime @default(now())
  createdAt   DateTime @default(now())
  comment     String?  // нове поле для коментаря, необов’язкове
}

